<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Registro Estudiante</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
            background: #f0f9ff;
        }
        .test-section { 
            background: white; 
            border: 1px solid #ddd; 
            border-radius: 8px;
            padding: 20px; 
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button { 
            background: #3b82f6; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        .result { 
            background: #f8f9fa; 
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px; 
            margin: 10px 0; 
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { border-left: 4px solid #10b981; background: #f0fdf4; }
        .error { border-left: 4px solid #ef4444; background: #fef2f2; }
        .info { border-left: 4px solid #3b82f6; background: #eff6ff; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Test del Sistema de Registro de Estudiantes</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ Datos de Prueba Disponibles</h2>
        <div class="info result">
Estudiantes disponibles para registro:
â€¢ Carlos Eduardo MartÃ­nez Silva - Doc: 5555666677 - CÃ³digo: DER2024003
â€¢ Ana SofÃ­a HernÃ¡ndez GÃ³mez - Doc: 7777888899 - CÃ³digo: DER2024004  
â€¢ Nicolas Melo - Doc: 1070924296 - CÃ³digo: DER66866156
â€¢ Daniel Perez - Doc: 12345678910 - CÃ³digo: DER6980BE25
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ” Test 1: ValidaciÃ³n de Datos Personales</h2>
        <button onclick="testValidacionDatos()">Probar ValidaciÃ³n</button>
        <div id="validacion-result" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>ğŸŒ Test 2: Acceso Frontend</h2>
        <button onclick="testFrontend()">Probar Frontend</button>
        <div id="frontend-result" class="result" style="display:none;"></div>
        
        <h3>Enlaces Directos:</h3>
        <button onclick="abrirRegistro()">ğŸ“ Abrir Registro (con datos)</button>
        <button onclick="abrirRegistroVacio()">ğŸ“ Abrir Registro (vacÃ­o)</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š Estado de Servicios</h2>
        <button onclick="checkServicios()">Verificar Servicios</button>
        <div id="servicios-result" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:8005/api';
        const FRONTEND_URL = 'http://localhost:3001';

        async function testValidacionDatos() {
            const resultDiv = document.getElementById('validacion-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'Probando validaciÃ³n...';
            
            try {
                const response = await fetch(`${API_URL}/auth/validar-datos-personales`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nombre: 'Carlos Eduardo',
                        apellidos: 'MartÃ­nez Silva',
                        documento_numero: '5555666677'
                    })
                });

                const data = await response.json();
                
                if (data.valido && data.estudiante && data.estudiante.codigo_estudiante) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… VALIDACIÃ“N EXITOSA\n\nDatos encontrados:\nâ€¢ Nombre: ${data.estudiante.nombre} ${data.estudiante.apellidos}\nâ€¢ CÃ³digo: ${data.estudiante.codigo_estudiante}\nâ€¢ Email: ${data.estudiante.email_institucional}\nâ€¢ Programa: ${data.estudiante.programa_academico}\nâ€¢ Semestre: ${data.estudiante.semestre}\n\nMensaje: ${data.mensaje}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ PROBLEMA EN LA VALIDACIÃ“N\n\nRespuesta: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ERROR EN LA CONEXIÃ“N\n\nError: ${error.message}`;
            }
        }

        async function testFrontend() {
            const resultDiv = document.getElementById('frontend-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'Probando frontend...';
            
            try {
                const response = await fetch(FRONTEND_URL);
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… FRONTEND FUNCIONANDO\n\nURL: ${FRONTEND_URL}\nStatus: ${response.status} ${response.statusText}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ PROBLEMA CON FRONTEND\n\nStatus: ${response.status} ${response.statusText}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ERROR CONECTANDO AL FRONTEND\n\nError: ${error.message}`;
            }
        }

        async function checkServicios() {
            const resultDiv = document.getElementById('servicios-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'Verificando servicios...';
            
            let status = 'ğŸ“Š ESTADO DE SERVICIOS:\n\n';
            
            // Check Backend
            try {
                const backendResponse = await fetch(`${API_URL}/auth/me`);
                status += `ğŸ”§ Backend (${API_URL}): âœ… Accesible\n`;
            } catch (error) {
                status += `ğŸ”§ Backend (${API_URL}): âŒ Error - ${error.message}\n`;
            }
            
            // Check Frontend
            try {
                const frontendResponse = await fetch(FRONTEND_URL);
                status += `âš›ï¸ Frontend (${FRONTEND_URL}): âœ… Accesible\n`;
            } catch (error) {
                status += `âš›ï¸ Frontend (${FRONTEND_URL}): âŒ Error - ${error.message}\n`;
            }

            resultDiv.className = 'result info';
            resultDiv.textContent = status;
        }

        function abrirRegistro() {
            const url = `${FRONTEND_URL}/registro-estudiante?nombre=Carlos%20Eduardo&apellidos=Mart%C3%ADnez%20Silva&documento_numero=5555666677`;
            window.open(url, '_blank');
        }

        function abrirRegistroVacio() {
            const url = `${FRONTEND_URL}/registro-estudiante`;
            window.open(url, '_blank');
        }

        // Auto-check al cargar la pÃ¡gina
        window.addEventListener('load', () => {
            setTimeout(checkServicios, 1000);
        });
    </script>
</body>
</html>